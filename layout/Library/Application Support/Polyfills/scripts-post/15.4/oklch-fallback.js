"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorValues(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function next(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(_typeof(e)+" is not iterable")}function _regenerator(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(c.prototype);return _regeneratorDefine2(u,"_invoke",function(r,n,o){var i,c,u,f=0,p=o||[],y=!1,G={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,r){return i=t,c=0,u=e,G.n=r,a}};function d(r,n){for(c=r,u=n,t=0;!y&&f&&!o&&t<p.length;t++){var o,i=p[t],d=G.p,l=i[2];r>3?(o=l===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=r<2&&d<i[1])?(c=0,G.v=n,G.n=i[1]):d<l&&(o=r<3||i[0]>n||n>l)&&(i[4]=r,i[5]=n,G.n=l,c=0))}if(o||r>1)return a;throw y=!0,n}return function(o,p,l){if(f>1)throw TypeError("Generator is already running");for(y&&1===p&&d(p,l),c=p,u=l;(t=c<2?e:u)||!y;){i||(c?c<3?(c>1&&(G.n=-1),d(c,u)):G.n=u:G.v=u);try{if(f=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(y=G.n<0)?u:r.call(n,G))!==a)break}catch(t){i=e,c=1,u=t}finally{f=1}}return{value:t,done:y}}}(r,o,i),!0),u}var a={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var c=[][n]?t(t([][n]())):(_regeneratorDefine2(t={},n,function(){return this}),t),u=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(u,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,o,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,o,"Generator"),_regeneratorDefine2(u,n,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,r,n,t){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}_regeneratorDefine2=function _regeneratorDefine(e,r,n,t){if(r)i?i(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n;else{var o=function o(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e)})};o("next",0),o("throw",1),o("return",2)}},_regeneratorDefine2(e,r,n,t)}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)})}}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}function _arrayWithHoles(r){if(Array.isArray(r))return r}(function polyfillOKLCHFallback(){var DEBUG=false;var LOG_PREFIX="[oklch-fallback]";var __logCount=0;var MAX_LOGS=400;function dbg(){if(!DEBUG)return;if(__logCount++>MAX_LOGS)return;try{var _console;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_console=console).debug.apply(_console,[LOG_PREFIX].concat(args))}catch(_){}}var stats={started:Date.now(),nativeSupported:null,styleSheets:0,sheetsChanged:0,sheetsFetched:0,styleTagsProcessed:0,inlineStyleAttrsProcessed:0,textReplacements:0,rulesIndexed:0,rulesApplied:0,observerEvents:0,errors:0};if(window.__oklchFallbackApplied)return;window.__oklchFallbackApplied=true;function parseNumberWithUnit(token){var m=String(token).trim().match(/^([+-]?(?:\d+\.\d+|\d*\.\d+|\d+))(.*)$/);if(!m)return null;return{value:parseFloat(m[1]),unit:(m[2]||"").trim()}}function hueToDeg(h,unit){if(!isFinite(h))return NaN;switch((unit||"deg").toLowerCase()){case"deg":case"":return h;case"grad":return h*.9;case"rad":return h*(180/Math.PI);case"turn":return h*360;default:return h}}function clamp01(x){return x<0?0:x>1?1:x}function linearToSRGB(x){return x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055}function oklchToSRGB(Lp,C,Hdeg){var hrad=Hdeg%360*Math.PI/180;var a=C*Math.cos(hrad);var b=C*Math.sin(hrad);var L=Lp;var l_=L+.3963377774*a+.2158037573*b;var m_=L-.1055613458*a-.0638541728*b;var s_=L-.0894841775*a-1.291485548*b;var l=l_*l_*l_;var m=m_*m_*m_;var s=s_*s_*s_;var r=+4.0767416621*l-3.3077115913*m+.2309699292*s;var g=-1.2684380046*l+2.6097574011*m-.3413193965*s;var b2=-.0041960863*l-.7034186147*m+1.707614701*s;r=linearToSRGB(r);g=linearToSRGB(g);b2=linearToSRGB(b2);return[clamp01(r),clamp01(g),clamp01(b2)]}function toRGBString(r01,g01,b01,a){var R=Math.round(r01*255);var G=Math.round(g01*255);var B=Math.round(b01*255);if(a==null||!(a>=0)||a>=1||a===undefined){return"rgb(".concat(R,", ").concat(G,", ").concat(B,")")}var A=typeof a==="string"?a:Math.max(0,Math.min(1,a))+"";return"rgba(".concat(R,", ").concat(G,", ").concat(B,", ").concat(A,")")}function tryParseOKLCHArgs(argText){var txt=argText.trim();if(/var\(|calc\(|env\(/i.test(txt)){return null}var parts=txt.split("/");var main=parts[0].trim();var alphaRaw=parts[1]?parts[1].trim():null;var tokens=main.split(/[\s,]+/).filter(Boolean);if(tokens.length<3){return null}var Lp=parseNumberWithUnit(tokens[0]);var C=parseNumberWithUnit(tokens[1]);var H=parseNumberWithUnit(tokens[2]);if(!Lp||!isFinite(Lp.value)){return null}if(!C||!isFinite(C.value)){return null}if(!H||!isFinite(H.value)){return null}var L01=Lp.unit==="%"||Lp.unit===""?Lp.unit==="%"?Lp.value/100:Lp.value:NaN;if(!isFinite(L01)){return null}var Cval=C.value;var Hdeg=hueToDeg(H.value,H.unit);if(!isFinite(Hdeg)){return null}var alpha=null;if(alphaRaw!=null){var a=parseNumberWithUnit(alphaRaw);if(a){alpha=a.unit==="%"?a.value/100:a.value}}return{L01:L01,C:Cval,Hdeg:Hdeg,alpha:alpha}}function replaceOKLCHInText(input){if(!input||typeof input!=="string")return input;var i=0;var out="";while(i<input.length){var idx=input.toLowerCase().indexOf("oklch(",i);if(idx===-1){out+=input.slice(i);break}out+=input.slice(i,idx);var j=idx+6;var depth=1;while(j<input.length&&depth>0){var ch=input[j];if(ch==="(")depth++;else if(ch===")")depth--;j++}var inside=input.slice(idx+6,j-1);var parsed=tryParseOKLCHArgs(inside);if(parsed){stats.textReplacements++;var L01=parsed.L01,C=parsed.C,Hdeg=parsed.Hdeg,alpha=parsed.alpha;var _oklchToSRGB=oklchToSRGB(L01,C,Hdeg),_oklchToSRGB2=_slicedToArray(_oklchToSRGB,3),r=_oklchToSRGB2[0],g=_oklchToSRGB2[1],b=_oklchToSRGB2[2];var rgb=toRGBString(r,g,b,alpha);out+=rgb}else{out+=input.slice(idx,j)}i=j}return out}var COLOR_PROPS=["color","background-color","background","outline-color","outline","text-decoration-color","text-decoration","border-color","border-top-color","border-right-color","border-bottom-color","border-left-color","border","border-top","border-right","border-bottom","border-left","column-rule-color","caret-color","fill","stroke"];function stripOuter(str,head,tail){var s=str.trim();if(s.toLowerCase().startsWith(head)&&s.endsWith(tail)){return s.slice(head.length,-tail.length)}return str}function splitTopLevelArgs(s){var out=[];var buf="";var depth=0;for(var i=0;i<s.length;i++){var ch=s[i];if(ch==="("){depth++;buf+=ch;continue}if(ch===")"){depth=Math.max(0,depth-1);buf+=ch;continue}if((ch===","||/\s/.test(ch))&&depth===0){if(buf.trim())out.push(buf.trim());buf="";continue}buf+=ch}if(buf.trim())out.push(buf.trim());return out}function resolveVar(el,chunk,localVars){var m=chunk.match(/^var\(\s*([^,\s)]+)\s*(?:,\s*(.*))?\)$/i);if(!m)return null;var name=m[1];var fallback=m[2];var val="";if(localVars&&Object.prototype.hasOwnProperty.call(localVars,name)){val=String(localVars[name]||"").trim()}if(!val){try{val=getComputedStyle(el).getPropertyValue(name)||""}catch(_){val=""}val=String(val).trim()}val=String(val).trim();if(!val&&fallback!=null)return String(fallback).trim();if(!val){var lname=name.toLowerCase();if(/(^|-)opacity$/.test(lname))return"1";if(/infinite/.test(lname))return"1000000";if(/(^|-)offset$/.test(lname))return"0";return"0"}return val||null}function resolveVarsRecursive(el,s){var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var localVars=arguments.length>3?arguments[3]:undefined;if(depth>5)return s;var out=s;var re=/var\(([^()]*?(?:\((?:[^()]+|\([^()]*\))*\)[^()]*)*)\)/gi;var m;while(m=re.exec(out)){var full=m[0];var inner=full;var val=resolveVar(el,inner,localVars)||"";out=out.replace(full,val);re.lastIndex=0}return/var\(/i.test(out)?resolveVarsRecursive(el,out,depth+1,localVars):out}function evalArithmetic(expr){var s=expr.replace(/\s+/g,"");var i=0;function peek(){return s[i]}function consume(){return s[i++]}function parseNumber(){var start=i;if(s[i]==="+"||s[i]==="-")i++;while(/[0-9]/.test(s[i]))i++;if(s[i]==="."){i++;while(/[0-9]/.test(s[i]))i++}if(s[i]==="e"||s[i]==="E"){i++;if(s[i]==="+"||s[i]==="-")i++;while(/[0-9]/.test(s[i]))i++}var str=s.slice(start,i);var v=parseFloat(str);return isFinite(v)?v:NaN}function parseFactor(){if(peek()==="("){consume();var v=parseExpr();if(peek()===")")consume();return v}return parseNumber()}function parseTerm(){var v=parseFactor();while(true){var op=peek();if(op==="*"||op==="/"){consume();var rhs=parseFactor();if(!isFinite(v)||!isFinite(rhs))return NaN;v=op==="*"?v*rhs:v/rhs}else break}return v}function parseExpr(){var v=parseTerm();while(true){var op=peek();if(op==="+"||op==="-"){consume();var rhs=parseTerm();if(!isFinite(v)||!isFinite(rhs))return NaN;v=op==="+"?v+rhs:v-rhs}else break}return v}var out=parseExpr();return isFinite(out)?out:NaN}function evalNumeric(el,token,kind,localVars){var s=String(token).trim();if(!s)return NaN;s=resolveVarsRecursive(el,s,0,localVars);function parseUnitNum(t){var u=parseNumberWithUnit(t);if(!u)return{val:NaN};return{val:u.value,unit:(u.unit||"").toLowerCase()}}if(/^clamp\(/i.test(s)){var inner=stripOuter(s,"clamp(",")");var parts=[];var depth=0,start=0;for(var i=0;i<inner.length;i++){var ch=inner[i];if(ch==="(")depth++;else if(ch===")")depth--;else if(ch===","&&depth===0){parts.push(inner.slice(start,i));start=i+1}}parts.push(inner.slice(start));if(parts.length===3){var minv=evalNumeric(el,parts[0],kind,localVars);var midv=evalNumeric(el,parts[1],kind,localVars);var maxv=evalNumeric(el,parts[2],kind,localVars);if([minv,midv,maxv].every(isFinite))return clamp(midv,minv,maxv)}return NaN}if(/^calc\(/i.test(s)){var _inner=stripOuter(s,"calc(",")");var mapped=_inner.replace(/([+-]?(?:\d+\.\d+|\d*\.\d+|\d+))(deg|rad|turn|%|[a-zA-Z]+)?/g,function(_,num,unit){var v=parseFloat(num);var u=(unit||"").toLowerCase();if(!unit||u==="")return String(v);if(kind==="L"||kind==="A"){if(u==="%")return String(v/100);return String(v)}if(kind==="H"){if(u==="deg"||u==="")return String(v);if(u==="rad")return String(v*(180/Math.PI));if(u==="turn")return String(v*360);if(u==="grad")return String(v*.9);return String(v)}if(kind==="C"){if(u==="%")return String(v/100);return String(v)}return String(v)});return evalArithmetic(mapped)}var pn=parseUnitNum(s);if(!isFinite(pn.val))return NaN;if(kind==="L"||kind==="A"){return pn.unit==="%"?pn.val/100:pn.val}if(kind==="H"){return hueToDeg(pn.val,pn.unit)}if(pn.unit==="%")return pn.val/100;return pn.val}function parseOKLCHCall(text){var lower=text.toLowerCase();var idx=lower.indexOf("oklch(");if(idx<0)return null;var j=idx+6,depth=1;while(j<text.length&&depth>0){var ch=text[j];if(ch==="(")depth++;else if(ch===")")depth--;j++}var inside=text.slice(idx+6,j-1);return inside}function computeOKLCHForElement(el,valueText,localVars){var inner=parseOKLCHCall(valueText);if(!inner)return null;var slash=inner.lastIndexOf("/");var main=(slash!==-1?inner.slice(0,slash):inner).trim();var alphaRaw=slash!==-1?inner.slice(slash+1).trim():null;try{main=resolveVarsRecursive(el,main,0,localVars)}catch(_){}try{if(alphaRaw)alphaRaw=resolveVarsRecursive(el,alphaRaw,0,localVars)}catch(_){}var tokens=splitTopLevelArgs(main);if(tokens.length<3){return null}var L=evalNumeric(el,tokens[0],"L",localVars);var C=evalNumeric(el,tokens[1],"C",localVars);var H=evalNumeric(el,tokens[2],"H",localVars);if(![L,C,H].every(isFinite)){if(__logCount<MAX_LOGS)dbg("Failed to eval OKLCH for",el,"tokens=",tokens,"resolved main=",main);return null}var L01=clamp(L,0,1);var A=1;if(alphaRaw){var a=evalNumeric(el,alphaRaw,"A",localVars);if(isFinite(a))A=clamp(a,0,1)}var _oklchToSRGB3=oklchToSRGB(L01,C,H),_oklchToSRGB4=_slicedToArray(_oklchToSRGB3,3),r=_oklchToSRGB4[0],g=_oklchToSRGB4[1],b=_oklchToSRGB4[2];return toRGBString(r,g,b,A)}function computeSpecificity(selector){var s=selector.replace(/:not\(([^)]*)\)/g,"$1");var a=(s.match(/#[\w-]+/g)||[]).length;var b=(s.match(/\.[\w-]+/g)||[]).length+(s.match(/\[[^\]]+\]/g)||[]).length+(s.match(/:(?!:)[\w-]+(\([^)]*\))?/g)||[]).length;var c=(s.replace(/::[\w-]+/g,"").match(/\b[a-zA-Z][\w-]*\b/g)||[]).length;return[a,b,c]}function compareSpec(a,b){for(var i=0;i<3;i++){if(a[i]!==b[i])return a[i]-b[i]}return 0}var OKLCH_RULE_INDEX=[];function collectOKLCHRules(){OKLCH_RULE_INDEX=[];var sheets=Array.from(document.styleSheets);var _loop=function _loop(si){var sheet=sheets[si];var rules;try{rules=sheet.cssRules}catch(e){dbg("collect: blocked cssRules for",sheet.href||"[inline]");return 0}if(!rules)return 0;var order=0;var _walk=function walk(list){for(var _i=0;_i<list.length;_i++){var r=list[_i];try{if(r&&r.cssRules&&r.cssRules.length){_walk(r.cssRules);continue}}catch(_){}if(!r||!r.selectorText||!r.style)continue;var localVars={};try{for(var k=0;k<r.style.length;k++){var pn=r.style[k];if(pn&&pn.startsWith("--")){localVars[pn]=r.style.getPropertyValue(pn)}}}catch(_){}var _iterator=_createForOfIteratorHelper(COLOR_PROPS),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var prop=_step.value;var val="";try{val=r.style.getPropertyValue(prop)||""}catch(_){val=""}if(val&&/oklch\(/i.test(val)){OKLCH_RULE_INDEX.push({selector:r.selectorText,prop:prop,val:val,important:r.style.getPropertyPriority(prop)==="important",si:si,oi:order++,spec:computeSpecificity(r.selectorText),localVars:localVars})}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}};_walk(rules)},_ret;for(var si=0;si<sheets.length;si++){_ret=_loop(si);if(_ret===0)continue}stats.rulesIndexed=OKLCH_RULE_INDEX.length;dbg("Indexed OKLCH rules:",OKLCH_RULE_INDEX.length);if(OKLCH_RULE_INDEX.length){var sampleCt=Math.min(3,OKLCH_RULE_INDEX.length);for(var i=0;i<sampleCt;i++){var e=OKLCH_RULE_INDEX[i];dbg("Rule",i+1+"/",sampleCt,"selector=",e.selector,"prop=",e.prop,"val=",e.val)}}}function mapPropToInline(prop){switch(prop){case"background":return"background-color";case"border":return"border-color";case"border-top":return"border-top-color";case"border-right":return"border-right-color";case"border-bottom":return"border-bottom-color";case"border-left":return"border-left-color";case"outline":return"outline-color";case"text-decoration":return"text-decoration-color";default:return prop}}function applyIndexedRules(){if(!OKLCH_RULE_INDEX.length)return;var all=document.querySelectorAll("*");var _iterator2=_createForOfIteratorHelper(all),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var el=_step2.value;var _iterator3=_createForOfIteratorHelper(COLOR_PROPS),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var prop=_step3.value;var winner=null;var _iterator4=_createForOfIteratorHelper(OKLCH_RULE_INDEX),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var entry=_step4.value;if(entry.prop!==prop)continue;try{if(!el.matches(entry.selector))continue}catch(_){continue}if(!winner){winner=entry;continue}if(entry.important!==winner.important){winner=entry.important?entry:winner;continue}var cmp=compareSpec(entry.spec,winner.spec);if(cmp>0){winner=entry;continue}if(cmp===0){if(entry.si>winner.si||entry.si===winner.si&&(entry.oi||0)>(winner.oi||0))winner=entry}}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}if(winner){var rgb=computeOKLCHForElement(el,winner.val,winner.localVars);if(rgb){var targetProp=mapPropToInline(prop);try{el.style.setProperty(targetProp,rgb,winner.important?"important":"");stats.rulesApplied++;if(stats.rulesApplied<=50)dbg("Applied",targetProp,"to",el,"from",winner.selector,"=>",rgb)}catch(e){stats.errors++;dbg("Failed set",targetProp,"on",el,e)}}}}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}function applyElementFallbacks(){collectOKLCHRules();applyIndexedRules()}function splitTopLevelCommas(s){var parts=[];var depth=0,start=0;for(var i=0;i<s.length;i++){var ch=s[i];if(ch==="(")depth++;else if(ch===")")depth--;else if(ch===","&&depth===0){parts.push(s.slice(start,i));start=i+1}}parts.push(s.slice(start));return parts.map(function(x){return x.trim()}).filter(Boolean)}function explodePseudoOnce(sel,name){var needle=":"+name+"(";var idx=sel.indexOf(needle);if(idx===-1)return null;var j=idx+needle.length,depth=1;while(j<sel.length&&depth>0){var ch=sel[j];if(ch==="(")depth++;else if(ch===")")depth--;j++}var before=sel.slice(0,idx);var inside=sel.slice(idx+needle.length,j-1);var after=sel.slice(j);var options=splitTopLevelCommas(inside);return options.map(function(opt){return(before+opt+after).trim()})}function explodeSelectorFunctions(sel){var queue=[sel];var out=new Set;while(queue.length){var cur=queue.pop();var isExp=explodePseudoOnce(cur,"is");if(isExp){isExp.forEach(function(s){return queue.push(s)});continue}var whereExp=explodePseudoOnce(cur,"where");if(whereExp){whereExp.forEach(function(s){return queue.push(s)});continue}var sanitized=cur.replace(/:has\((?:[^()]+|\([^()]*\))*\)/g,"*");out.add(sanitized)}return Array.from(out)}function applyIndexedRulesByQuery(){if(!OKLCH_RULE_INDEX.length)return;var entries=OKLCH_RULE_INDEX.slice().sort(function(a,b){return a.si-b.si||(a.oi||0)-(b.oi||0)});var applied=0,errors=0;var _iterator5=_createForOfIteratorHelper(entries),_step5;try{var _loop2=function _loop2(){var entry=_step5.value;var cands=explodeSelectorFunctions(entry.selector);var nodes=[];var _iterator6=_createForOfIteratorHelper(cands),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var cand=_step6.value;try{var _nodes;var list=document.querySelectorAll(cand);if(list&&list.length)(_nodes=nodes).push.apply(_nodes,_toConsumableArray(list))}catch(e){}}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}if(!nodes.length)return 1;var seen=new Set;nodes=nodes.filter(function(n){if(seen.has(n))return false;seen.add(n);return true});var _iterator7=_createForOfIteratorHelper(nodes),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var el=_step7.value;var rgb=computeOKLCHForElement(el,entry.val,entry.localVars);if(!rgb)continue;try{var targetProp=mapPropToInline(entry.prop);var existingImportant=el.style.getPropertyPriority(targetProp)==="important";var prio=entry.important||existingImportant?"important":"";el.style.setProperty(targetProp,rgb,prio);applied++;if(applied<=50)dbg("Applied (query)",targetProp,"to",el,"from",entry.selector,"=>",rgb)}catch(e){errors++}}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}};for(_iterator5.s();!(_step5=_iterator5.n()).done;){if(_loop2())continue}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}stats.rulesApplied+=applied;if(applied===0)dbg("applyIndexedRulesByQuery applied none");else dbg("applyIndexedRulesByQuery applied",applied)}function applyComputedStyleFallbacks(){var all=document.querySelectorAll("*");dbg("Computed-style fallback scanning elements:",all.length);var hits=0;var _iterator8=_createForOfIteratorHelper(all),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var el=_step8.value;var cs=void 0;try{cs=getComputedStyle(el)}catch(_){continue}var _iterator9=_createForOfIteratorHelper(COLOR_PROPS),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var prop=_step9.value;var val="";try{val=cs.getPropertyValue(prop)||""}catch(_){val=""}if(val&&/oklch\(/i.test(val)){hits++;var rgb=computeOKLCHForElement(el,val);if(rgb){var targetProp=mapPropToInline(prop);try{el.style.setProperty(targetProp,rgb,"");stats.rulesApplied++;if(stats.rulesApplied<=50)dbg("Applied (computed)",targetProp,"to",el,"=>",rgb)}catch(e){stats.errors++;dbg("Failed to set computed fallback",targetProp,"on",el,e)}}}}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}dbg("Computed-style fallback hits:",hits,"applied:",stats.rulesApplied)}var RULE={STYLE:1,MEDIA:4,FONT_FACE:5,PAGE:6,KEYFRAMES:7,SUPPORTS:12};function processStyleDeclaration(style){if(!style)return false;var changed=false;for(var k=0;k<style.length;k++){var prop=style[k];var val=style.getPropertyValue(prop);if(val&&val.toLowerCase().includes("oklch(")){var priority=style.getPropertyPriority(prop);var newVal=replaceOKLCHInText(val);if(newVal!==val){try{style.setProperty(prop,newVal,priority);changed=true}catch(_){}}}}return changed}function traverseAndFixRules(rules){if(!rules)return false;var anyChanged=false;for(var _i2=0,_Array$from=Array.from(rules);_i2<_Array$from.length;_i2++){var rule=_Array$from[_i2];var ctor=rule&&rule.constructor&&rule.constructor.name;if(rule.type===RULE.STYLE||ctor==="CSSStyleRule"){anyChanged=processStyleDeclaration(rule.style)||anyChanged}else if(rule.type===RULE.KEYFRAMES||ctor==="CSSKeyframesRule"||ctor==="WebKitCSSKeyframesRule"){for(var _i3=0,_Array$from2=Array.from(rule.cssRules||[]);_i3<_Array$from2.length;_i3++){var kf=_Array$from2[_i3];var changed=processStyleDeclaration(kf.style);anyChanged=changed||anyChanged}}else if(rule.type===RULE.FONT_FACE||ctor==="CSSFontFaceRule"||rule.type===RULE.PAGE||ctor==="CSSPageRule"){anyChanged=processStyleDeclaration(rule.style)||anyChanged}var childRules=rule.cssRules||null;if(childRules)anyChanged=traverseAndFixRules(childRules)||anyChanged}return anyChanged}function getStyleSheetText(sheet){try{var rules=Array.from(sheet.cssRules||sheet.rules||[]);return rules.map(function(r){return r.cssText}).join("\n")}catch(_){return null}}function injectStyle(css,id){if(id){var existing=document.getElementById(id);if(existing)return existing}var style=document.createElement("style");if(id)style.id=id;style.textContent=css;document.head.appendChild(style);return style}function processStyleTagNode(styleNode){if(!styleNode||styleNode.__oklchProcessed)return;var txt=styleNode.textContent;if(txt&&/oklch\(/i.test(txt)){var out=replaceOKLCHInText(txt);if(out!==txt){styleNode.textContent=out;stats.styleTagsProcessed++;dbg("Processed <style> tag, replaced OKLCH")}}styleNode.__oklchProcessed=true}function processStyleSheetObject(_x){return _processStyleSheetObject.apply(this,arguments)}function _processStyleSheetObject(){_processStyleSheetObject=_asyncToGenerator(_regenerator().m(function _callee(sheet){var changed,cssText,out,_t;return _regenerator().w(function(_context){while(1)switch(_context.n){case 0:_context.p=0;changed=traverseAndFixRules(sheet.cssRules);if(!changed){_context.n=1;break}stats.sheetsChanged++;dbg("Edited CSSOM in-place for sheet",sheet.href||"[inline]");return _context.a(2,true);case 1:_context.n=3;break;case 2:_context.p=2;_t=_context.v;dbg("Cannot access cssRules for sheet; will try text/fetch path",sheet.href||"[inline]",_t);stats.errors++;case 3:cssText=getStyleSheetText(sheet);if(!(cssText&&cssText.toLowerCase().includes("oklch("))){_context.n=4;break}out=replaceOKLCHInText(cssText);if(!(out!==cssText)){_context.n=4;break}injectStyle(out);dbg("Injected fallback <style> for sheet text",sheet.href||"[inline]");return _context.a(2,true);case 4:return _context.a(2,false)}},_callee,null,[[0,2]])}));return _processStyleSheetObject.apply(this,arguments)}function hashString(s){var h=0;for(var i=0;i<s.length;i++){h=(h<<5)-h+s.charCodeAt(i)|0}return(h>>>0).toString(36)}function fetchAndInlineStylesheet(_x2){return _fetchAndInlineStylesheet.apply(this,arguments)}function _fetchAndInlineStylesheet(){_fetchAndInlineStylesheet=_asyncToGenerator(_regenerator().m(function _callee2(href){var res,text,out,id,_t2;return _regenerator().w(function(_context2){while(1)switch(_context2.n){case 0:_context2.p=0;_context2.n=1;return fetch(href,{mode:"cors"});case 1:res=_context2.v;if(res.ok){_context2.n=2;break}return _context2.a(2,false);case 2:_context2.n=3;return res.text();case 3:text=_context2.v;if(/oklch\(/i.test(text)){_context2.n=4;break}return _context2.a(2,false);case 4:out=replaceOKLCHInText(text);if(!(out!==text)){_context2.n=5;break}id="oklch-inline-"+hashString(href);injectStyle(out,id);stats.sheetsFetched++;dbg("Fetched and inlined stylesheet with OKLCH",href);return _context2.a(2,true);case 5:_context2.n=7;break;case 6:_context2.p=6;_t2=_context2.v;dbg("Failed to fetch stylesheet",href,_t2);stats.errors++;case 7:return _context2.a(2,false)}},_callee2,null,[[0,6]])}));return _fetchAndInlineStylesheet.apply(this,arguments)}function processAllStyleSheets(){return _processAllStyleSheets.apply(this,arguments)}function _processAllStyleSheets(){_processAllStyleSheets=_asyncToGenerator(_regenerator().m(function _callee3(){var links,allSheets,_loop3,_i4,_allSheets,appliedBefore;return _regenerator().w(function(_context4){while(1)switch(_context4.n){case 0:links=Array.from(document.querySelectorAll('link[rel="stylesheet"]'));allSheets=Array.from(document.styleSheets);stats.styleSheets=allSheets.length;dbg("Processing stylesheets:",allSheets.length);_loop3=_regenerator().m(function _loop3(){var sheet,href,handled,abs;return _regenerator().w(function(_context3){while(1)switch(_context3.n){case 0:sheet=_allSheets[_i4];href=sheet.href||"";_context3.n=1;return processStyleSheetObject(sheet);case 1:handled=_context3.v;if(!handled){_context3.n=2;break}return _context3.a(2,1);case 2:if(!href){_context3.n=3;break}abs=function(){try{return new URL(href,location.href)}catch(_){return null}}();if(!(abs&&(abs.protocol==="http:"||abs.protocol==="https:"))){_context3.n=3;break}_context3.n=3;return fetchAndInlineStylesheet(abs.href);case 3:return _context3.a(2)}},_loop3)});_i4=0,_allSheets=allSheets;case 1:if(!(_i4<_allSheets.length)){_context4.n=4;break}return _context4.d(_regeneratorValues(_loop3()),2);case 2:if(!_context4.v){_context4.n=3;break}return _context4.a(3,3);case 3:_i4++;_context4.n=1;break;case 4:document.querySelectorAll("style").forEach(processStyleTagNode);document.querySelectorAll('[style*="oklch("]').forEach(function(el){try{var txt=el.getAttribute("style");if(!txt)return;var out=replaceOKLCHInText(txt);if(out!==txt){el.setAttribute("style",out);stats.inlineStyleAttrsProcessed++}}catch(e){dbg("Failed processing inline style for element:",el,e)}});appliedBefore=stats.rulesApplied;try{applyElementFallbacks()}catch(e){dbg("applyElementFallbacks failed",e);stats.errors++}if(!OKLCH_RULE_INDEX.length||stats.rulesApplied===appliedBefore){dbg("matches()-based path applied none; trying query-based application");try{applyIndexedRulesByQuery()}catch(e){dbg("applyIndexedRulesByQuery failed",e);stats.errors++}}if(!OKLCH_RULE_INDEX.length||stats.rulesApplied===appliedBefore){dbg("No indexable rules or nothing applied; trying computed-style fallback");try{applyComputedStyleFallbacks()}catch(e){dbg("applyComputedStyleFallbacks failed",e);stats.errors++}}dbg("Pass summary:",JSON.stringify({styleSheets:stats.styleSheets,sheetsChanged:stats.sheetsChanged,sheetsFetched:stats.sheetsFetched,styleTagsProcessed:stats.styleTagsProcessed,inlineStyleAttrsProcessed:stats.inlineStyleAttrsProcessed,textReplacements:stats.textReplacements,rulesIndexed:stats.rulesIndexed,rulesApplied:stats.rulesApplied}));case 5:return _context4.a(2)}},_callee3)}));return _processAllStyleSheets.apply(this,arguments)}function setupMutationObserver(){var observer=new MutationObserver(function(mutations){stats.observerEvents+=mutations.length;var needs=false;var _iterator0=_createForOfIteratorHelper(mutations),_step0;try{for(_iterator0.s();!(_step0=_iterator0.n()).done;){var m=_step0.value;if(m.type==="childList"){var _iterator1=_createForOfIteratorHelper(m.addedNodes),_step1;try{for(_iterator1.s();!(_step1=_iterator1.n()).done;){var node=_step1.value;if(node.nodeType!==1)continue;if(node.tagName==="STYLE"){processStyleTagNode(node);needs=true}else if(node.tagName==="LINK"&&node.rel==="stylesheet"){needs=true}else{var styleNodes=node.querySelectorAll&&node.querySelectorAll('style, link[rel="stylesheet"], [style*="oklch("]');if(styleNodes&&styleNodes.length)needs=true}}}catch(err){_iterator1.e(err)}finally{_iterator1.f()}}else if(m.type==="attributes"){var t=m.target;if(t.tagName==="LINK"&&t.rel==="stylesheet"&&(m.attributeName==="href"||m.attributeName==="rel")||m.attributeName==="style"&&/oklch\(/i.test(t.getAttribute("style")||"")){needs=true}}}}catch(err){_iterator0.e(err)}finally{_iterator0.f()}if(needs){clearTimeout(window.__oklchDebounce);window.__oklchDebounce=setTimeout(processAllStyleSheets,100)}});observer.observe(document,{childList:true,subtree:true,attributes:true,attributeFilter:["href","rel","style"]});return observer}dbg("OKLCH fallback enabled");processAllStyleSheets();setupMutationObserver()})();